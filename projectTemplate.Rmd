TITLE by YOUR_NAME_HERE
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)

```
```{r echo=FALSE, Univariate_Plots}
names(pLD)

```{r} 
names(pLD)
```
```{r}

str(pLD)
```
```{r echo=FALSE, Load_the_Data}
# Load the Data
setwd("C:/Users/apple/Desktop/P4")
pLD <- read.csv('prosperLoanData.csv')


```

# Univariate Plots Section
As we can see, this is the dataset which includes more than 81 variables and it's impossible to investigate all of them. Before starting to start the detailed plotting section, I would like to catograize them into four main catograries in order to understand the differences and relationship between each other.

#About reliability of borrowers

* Employment Status
* Employment Status Duration
* Occupation
* Home owner
* StatedMonthlyIncome
* IncomeVerifiable

These are the factors when we consider if a borrow is able to pay the loan or not. By intuition, some who own his own house and has a good job with high income should pay the credit with more reputation. 

# valuation about Borrower

* Credit Grade
* Credit Score
* Prosper Rating
* CreditScoreRange


Except CreditLines, who only implicitly shows how many loan a borrower should deserve to have, other variables are just using different ways, or differet grading system established by different organisation, to describe the reputation of the borrower in term of borrrowing.

# Credit charactoristic
* Borrower APR/RATE/Lender Yield
* Loan Original Amount
* Term
* investor

These variables describe how is the P2P-credit formed.

# after the launch of Credit

* Revovlving Account
* Loan Status
* DelinquenciesAmount

These variables happen only after the the credit is issued.


These four catogaries actually follow by the time line of the launch of credit. From the formation of the personilty of borrower, to the valuation to his/her, then the credit will be valued by the investors. At the end, the credit will be issued and the payment begins.

First of all, we start our Univariate Plots by following this time line.


#1. About reliability of borrowers

```{r}
#EmploymentStatus
ggplot(aes(EmploymentStatus), data = pLD) + geom_bar()
```
The majority of borrowers belong to the "Employed", which is actually an ambiguous term and doesn't tell us whether the borrowers are working on basis of "Part-time" or "Full-time". And "self-emplyed" can be interpreted as a type of "employed". But as least these four types of "employed" dominate the employment status. These four types of people have a job and overwhelmingly represent the majority:

```{r}
employed <- subset(pLD, EmploymentStatus == "Employed" | EmploymentStatus == "Full-time" | EmploymentStatus == "Part-time" | EmploymentStatus == "Self-employed")

nrow(employed)/nrow(pLD)

```


What does it mean with the blank on the left-hand side? Did the borrower missed filling the statement about their employment Status? Let's zoom this kind of "blank" Status:

```{r}
blank_employment <- subset(pLD, EmploymentStatus == "")
summary(blank_employment$LoanStatus)

```
The interesting thing is that none of these credits is current credit or past due. They are completed, or fail to pay the credit in states of defaulted or charged-off, which are "ended" on some sense. This may not be a mere coincidence and later we can see that lots of our data come from current credit.

```{r}
pLD <- transform(pLD, JobOwner = ifelse(EmploymentStatus == "Employed" | EmploymentStatus == "Full-time" | EmploymentStatus == "Part-time" | EmploymentStatus == "Self-employed", "True", "False"))
```


```{r}
# EmploymentStatusDuration
ggplot(aes(EmploymentStatusDuration), data = pLD) + geom_histogram() + scale_x_continuous(limits = c(0, 600), breaks = seq(0, 600, 30))
```
It presents a very neat trend of the duration. The detail of the trend is that differences between groups of bin become smaller, as the duration goes up, so that we can observe the curve become flater around the left hand side of the graph.

It is resonable since it may also imply age distribution:The younger you are, the shorter you've worked. Obviously, P2P borrowing is relatively a new concept comparing to the tradition finanical instruments, which should be recognized by more young poeple than elderly.

In order to show the graph in a form of normal distribution, we can sub the x variable into the log function.
```{r}
ggplot(aes(EmploymentStatusDuration), data = pLD) + geom_histogram() +  scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 
```

Although it shows us a normal distribution, but more data are lost during the prozess by removing more than 9100 rows of the dataset. But it remains me that even we don't use the method of log function, we still need to remove more than 7000 rows since there is the majority of "finite values".

#Occupation
```{r}

occupation_plot <- ggplot(aes(Occupation), data = pLD) + geom_bar() + theme(axis.text.x = element_text(angle = 90, hjust = 1))
occupation_plot
```
Again, there are ambiguous catogories. This time, they are "Other" and "Professional" which don't tell a specific name of the jobs. Like the section of "Employment Status", lot of people intend to hide their private informations. I wonder if these kinds of borrowers tend to hide the details of these two sections at the same time.

```{r}
detail_hiding <- subset(pLD[c("Occupation", "EmploymentStatus")], EmploymentStatus == "Employed")
hiding_occupation_plot <- ggplot(aes(Occupation), data = detail_hiding) + geom_bar() + theme(axis.text.x = element_text(angle = 90, hjust = 1))
hiding_occupation_plot
```
It seems that there are almost no differences between the distribution form. The second one is just like the the version of the first one with smaller amount on y-axis. Using ambiguous catogary may be not a important feature to consider.
```{r}
#home owner
ggplot(aes(IsBorrowerHomeowner), data = pLD) + geom_bar()

table(pLD$IsBorrowerHomeowner)
```
The differences is about 1000 people, which is less than 1% of the objects in the whole dataset.

```{r}
#Income Range

pLD$IncomeRange <- factor(pLD$IncomeRange,
                          levels = c(
    "Not displayed",
    "Not employed",
    "$0",
    "$1-24,999",
    "$25,000-49,999",
    "$50,000-74,999",
    "$75,000-99,999",
    "$100,000+"
    ))
levels(pLD$IncomeRange)
ggplot(aes(IncomeRange), data = pLD) + geom_bar()
```
It seems a reasonalbe distribution, because the most of distribution concentrate to the range of "$25,000-49,999" and "$50,000-74,999", the middle of the income range. And we should compare it to the stated monthly Income in order to verify the data.
```{r}
#StatedMonthlyIncome
ggplot(aes(StatedMonthlyIncome), data = subset(pLD, !is.na(StatedMonthlyIncome))) + geom_histogram() + scale_x_continuous(limits = c(0, 40000)) + 
                geom_freqpoly() 
```
It has the simliar form of slightly Skewed distribution, which needs the log function to become a normal distribution.

```{r}

ggplot(aes(StatedMonthlyIncome), data = subset(pLD, !is.na(StatedMonthlyIncome))) + geom_histogram() + scale_x_continuous(limits = c(0, 40000)) + 
                geom_freqpoly() +
   scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 
```

```{r}
summary(pLD$StatedMonthlyIncome)
```

As we can see most of income don't reach the magnitude of 10^4. As we can see in the summary, the mean of the data just reach 5608 or approximately 10^(3.74).

But is the data of income reliable? We can limit the data set with the variable of IncomeVerifiable.

```{r}
# IncomeVerifiable?

summary(pLD$IncomeVerifiable)
ggplot(aes(IncomeRange), data = subset(pLD, IncomeVerifiable == "True")) + geom_bar()


ggplot(aes(x = StatedMonthlyIncome), data = pLD) + geom_freqpoly(color = "yellow") + scale_x_continuous(limits = c(0, 40000)) + geom_freqpoly(data = subset(pLD, IncomeVerifiable == "True"), aes(color = StatedMonthlyIncome), color = "orange") + theme_minimal()

```
The first picture of our Income Range distribution has no obvious changes. The second picture shows the differences between the original and the one which excludes the unverified data. These two lines show the similar form. It means most of our data about income is trustable.

# 2. valuation about Borrower

There are three different ways to describe the grading:

* Credit Grade
* Prosper Rating
* Credit Score Range

During my research, no evidence has been found to show that the Credit Score Range in this data set come from the FICO score or Vantage score, which two of the most famous for credit grading,

https://www.creditsesame.com/blog/credit/credit-score-range-for-experian-transunion-equifax/

since the range doesn't stay consistant to their standards. 



https://www.creditsesame.com/blog/credit/credit-score-range-for-experian-transunion-equifax/

https://your.vantagescore.com/interpret_scores

First of all, we need to make a subset including these variables or relative variables in order to examine them with a closer look.

```{r}
grade_comparation <- pLD[c("LoanStatus", "CreditGrade", "ProsperRating..Alpha.", "ProsperScore", "CreditScoreRangeLower", "CreditScoreRangeUpper")]

summary(subset(grade_comparation, CreditGrade == "E")$CreditScoreRangeUpper)
summary(subset(grade_comparation, CreditGrade == "D")$CreditScoreRangeUpper)
summary(subset(grade_comparation, CreditGrade == "C")$CreditScoreRangeUpper)
```


Although we don't know from what kind of institution the credit grade was issued, according to the common definition of credit grade, we know that the grade of E to A represent the credit reputation from bad to the better position. The only one which is worse than E is the grade of HR.

As we can see, the credit score range seems to relate to the credit grade, since as the credit grade goes up, the range of credit score goes up as well.

But it is a different story when we examine the rating from prosper:

```{r}

summary(subset(grade_comparation, ProsperRating..Alpha. == "E")$CreditScoreRangeUpper)
summary(subset(grade_comparation, ProsperRating..Alpha. == "D")$CreditScoreRangeUpper)
summary(subset(grade_comparation, ProsperRating..Alpha. == "C")$CreditScoreRangeUpper)

```
From the grade of E to C, the they share the same minimum range of credit score. The maximum score of grade C is just a little bit higher than D and E.

We can examine the differences between these two system of rating by using graphs:


```{r}
pLD$CreditGrade <- factor(pLD$CreditGrade,
                          levels = c(
 "", "NC", "HR", "E", "D", "C", "B", "A", "AA" 
    ))
ggplot(aes(CreditGrade), data = pLD) + geom_bar() 
```


```{r}
pLD$ProsperRating..Alpha. <- factor(pLD$ProsperRating..Alpha.,
                          levels = c(
 "", "HR", "E", "D", "C", "B", "A", "AA" 
    ))
ggplot(aes(ProsperRating..Alpha.), data = pLD) + geom_bar() 
```

So why ist the "Null value" also the largest part in these two graphs? It is found that all of the credit grade are only applied to the "ended" loan but never to the current loan.
```{r}
non_null_CreditGrade <- subset(pLD, CreditGrade != "")
summary(non_null_CreditGrade$LoanStatus)
```
At the first time, I thought that the credit grade was only applied to the "ended" credit. So it is reasonable to assume the prosper rating only reveal the current credit. But: it isn't. It includes all kind of situation:

```{r}
non_null_ProsperRating <- subset(pLD, ProsperRating..Alpha. != "")
summary(non_null_ProsperRating$LoanStatus)
```

And there are no a single row of data consist two grading.

```{r}
Rating_same_time <- subset(pLD, ProsperRating..Alpha. != "" & CreditGrade != "")
nrow(Rating_same_time)
```


The weirder thing is : the score range is always filled and has no any null value.

```{r}
non_null_lower_score <- subset(pLD, CreditScoreRangeLower == "")
nrow(non_null_lower_score)
non_null_upper_score <- subset(pLD, CreditScoreRangeUpper == "")
nrow(non_null_upper_score) 
```

That means we can have the whole picture of the data set via the credit score:

```{r}
# sum up and take the average number of the score range to help building better view of scope
pLD <- transform(pLD, AverageScore = (CreditScoreRangeLower + CreditScoreRangeUpper)/2)


ggplot(aes(AverageScore), data = pLD) + geom_histogram()

#ignore the extreme low value of credit to have better view of the histogram
ggplot(aes(AverageScore), data = pLD) + geom_histogram() + scale_x_continuous(limits = c(350, 1000), breaks = seq(0, 1000, 125)) 

```

To conclude from these results:

1. When we want to investigae the credit performance of all the borrowers, we can use average score of the score range. Although the source of the score is unknown, it covers all of the data of borrower. 

In principle, the rating from Prosper is less believable because the rating is displayed on the homepage of the prosper for investors to choose the products, 
https://www.prosper.com/invest

which means the rating may not be accurate to represent the credibility of the borrowers, but may consider making some investment more attractive. We can investigate it in the Bivariate Analysis section.

2. When we want to investigate the relationship between the rating and the number of investors, we should use the Prosper Rating. As we just discussed, the rating is revealed as the important part of description of the borrower's status. But we should be careful to use it since it's limited to the current loan.




# Credit charactoristic

* Borrower APR/RATE/Lender Yield

Actually these three variables describe the same thing on three different angles: interest rate.

The differences between Lender Yield and Borrower Rate is "a servicing fee charged by the originator to the investor each time a payment is made".
https://www.orchardplatform.com/blog/2014519lender-yield-prosper/(it seems that it is using the same Prosper Dataset as well)

The "orignator" here is Prosper.

Moreover, the borrowers need to pay the extra fee the orignator/Prosper. That is the differences between Borrower APR and Borrower Rate. The first one include "other charges or fees such as mortgage insurance, most closing costs, discount points and loan origination fees."

https://www.bankofamerica.com/mortgage/learn/apr-vs-interest-rate/

So, the relationship between Borrower APR and Lender Yield should be like this:

Borrower APR = Lender Yield +  + extra fee paid by investors/lenders + extra fee paid by borrowers
 
So we can be sure that all the rate generally will move higher by following the order of "Lender Yield < Borrower Rate < Borrower APR".


```{r}
install.packages("cowplot")
library(cowplot)
plot_grid(LY, BR, BA, ncol=1, align="hv")


library(gridExtra)
theme_set(theme_grey())

LY <- ggplot(aes(LenderYield), data = pLD) + geom_histogram() + scale_x_continuous(limits = c(0, 0.4), breaks = seq(0, 0.4, 0.05))

BR <- ggplot(aes(BorrowerRate), data = pLD) + geom_histogram() + scale_x_continuous(limits = c(0, 0.4), breaks = seq(0, 0.4, 0.05))

BA <- ggplot(aes(BorrowerAPR), data = pLD) + geom_histogram() + scale_x_continuous(limits = c(0, 0.4), breaks = seq(0, 0.4, 0.05))

grid.arrange(LY, BR, BA, ncol = 1)


```

Both of the extra fees, are in the most of the time "irregular" and depend on the the condition of investors and borrowers, so that we can see the form of three graphs have subtle differences on their distributions, but the trend of moving the bar towards the right hand side is still obvious, especially the "shift" happening on the graph of Borrower APR.

In order to gain a greater overview upon the interest, we can also put variables of "Estimated Rate": Yield, Loss and Rate


```{r}
ggplot(pLD, aes(x = LenderYield, y = ..count.., color = "Lender Yield")) + geom_freqpoly() +
  geom_freqpoly(aes(x = BorrowerRate, y = ..count.., color = "Borrower Rate")) +
  geom_freqpoly(aes(x = BorrowerAPR, y = ..count.., color = "Borrower APR")) + xlab("Rate Comparation") + guides(color=guide_legend(title="Type of Rate"))  
```

* Loan Original Amount

Next question is: how much have the borrowers borrowed?

```{r}

ggplot(aes(LoanOriginalAmount), data = pLD) + geom_histogram(bins= 100) + scale_x_continuous(limits = c(0, 40000), breaks = seq(0, 40000, 2500))

```

It is a different distribution than the interest rate which is calculated with the specific formula and weight. This one is chose by the human borrowers and it is clear that some of amounts or numbers are popular among the others.

```{r}
dataSummary <- pLD  %>%
  group_by(LoanOriginalAmount) %>% summarise(n = n())

dataSummary <- dataSummary[order(-dataSummary$n),] 

head(dataSummary)
```
As we can see, borrowers raise their request with the simple whole numbers. It is quite understandable since borrowers don't know how much they need to finance their businesses.



* Term

There are three types of term in the dataset: 12, 36, 60. The number actually represents the payment duration options provided by Prosper: in how many months a borrower need to pay back the credit or so-called a monthly loan payment. 

```{r}
library(dplyr)

ggplot(aes(Term), data = pLD) + geom_bar() + scale_x_continuous(breaks = c(12, 36, 60))

Terms_labels <- pLD %>%
  group_by(Term) %>% summarise('n' = n()) %>% mutate(percent = round(n/nrow(pLD)*100)) %>% mutate(label = paste0(percent, "%")) %>% arrange(percent)

ggplot(data = Terms_labels, aes(x=factor(1), , y=n, fill=factor(Term))) + geom_bar(width = 1, stat = "identity") + coord_polar(theta="y") + geom_text(aes(x=1, y = cumsum(n) - n/2, label = label))
```

The preference of 3-year loan dominates the majority of the borrowers.



* investor

Investors or lenders lend the money to the borrowers on the platform of Prosper.

```{r}
ggplot(aes(Investors), data = pLD) + geom_histogram() + scale_x_continuous(limits = c(0, 600), breaks = seq(0, 600, 30)) + scale_y_continuous(limits = c(0, 15000))
```

As we are having a univariable analyse, the changes of x axis/exogenous variable result in the y axis/endogenous variable. Here the endogenous variable shows how many credit there are. The graph shows us a negative correlation. When the number of investors goes up, the number of credit goes down at the same time.

```{r}
ggplot(aes(Investors), data = pLD) + geom_histogram() + scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 

```
Interesting thing happens: Fristly, around the range from 10^0.5 to 10^3, we have a normal distribution with high variance, so that the distribution looks flater. Secondly, the majority of investors just reach the magnitude of 10^0, which means 1! 
```{r}
summary(pLD$Investors)
```
As the summary shows, th mean is near to the level of 10^2, which forms the "pike" in the form of normal distribution. 

The minimum number of the dataset is only 1 and its first quarter is just 2. It is because there are lots of small amount of investors in the dataset.

```{r}
nrow(subset(pLD, Investors == "1"))/nrow(pLD)
```

Almost a quarter of loan credit only get 1 investor.

# after the launch of Credit

* Revovlving Account

According to the definition from Wikipedia, A revolving account is "an account created by a lender to represent debts where the outstanding balance does not have to be paid in full every month by the borrower to the lender."  https://en.wikipedia.org/wiki/Revolving_account

But it has its limitation and the borrowers should pay the principal and interest for what he owned in the following month. http://blog.credit.com/2013/04/how-a-revolving-credit-account-works-65670/

I have not heard of this term before, but to my own opinion, it creates an account to help the borrowers delay their payment. It is a interesting payment strategy to avoid damage the reputation or the creidt grade of the borrower without paying on time.

```{r}
ggplot(aes(OpenRevolvingMonthlyPayment), data = pLD) + geom_histogram() + scale_x_continuous(limits = c(0, 2000), breaks = seq(0, 2000, 100)) + scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 

summary(pLD$OpenRevolvingMonthlyPayment)
```

People seem only afford small amount of credit around 100 to 1000 in order to keep their record. So do most of them pay the credit on time? Let's see the distribution of Loan Status.


* Loan Status

**Completed: fully paid off

**Final Payment in Progress: move to the completed status within the next period

**Current: making payments on time

**Past Due: payment is missed

**Charge Off: After 4 missed payments, the status of "current" will move ot "charge-off". In this situation, the investment is assumed to be lost.

**Defaulted: reasons like bankruptcy make the borrowers fail to make the payment

https://www.orchardplatform.com/blog/understanding-loan-statuses/
https://en.wikipedia.org/wiki/Default_(finance)

```{r}

pLD$LoanStatus <- factor(pLD$LoanStatus,
                          levels = c(
    "Cancelled",
    "Current",
    "Completed",
    "Past Due (1-15 days)",
    "Past Due (16-30 days)",
    "Past Due (31-60 days)",
    "Past Due (61-90 days)",
    "Past Due (91-120 days)",
    "Past Due (>120 days)",
    "Chargedoff",
    "Defaulted"
    ))


ggplot(aes(LoanStatus), data = pLD) + geom_bar() + theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
Most of the loans is either completed or current. But the category of "Past Due (>120 days)" makes me curios. According to the definition, the column of "Past Due (>120 days)" should not exist because Past Due which is longer than 120 days should be categorized as Charged-off. Some said it is more than 180 Days. https://www.thebalance.com/deal-with-past-due-accounts-961128 / https://en.wikipedia.org/wiki/Charge-off

```{r}
nrow(subset(pLD, LoanStatus == "Past Due (>120 days)"))
```
The number of "Past Due (>120 days)" is only 16, which is extremely small number comparing the whole number of data data, so it is almost unobservable in the graph of Loan Status. 

How about put it in another way: maybe the borrowers with charge off may owe more money? 

We have the variable of "Amount of Delinquencies" to investigate. And "delinquent is an individual or corporation with a contractual obligation to make payments against a loan in a timely manner, such as through a mortgage, but payments are not made on time." 

https://www.investopedia.com/terms/d/delinquent.asp

```{r}
subset(pLD, LoanStatus == "Chargedoff")["AmountDelinquent"]
subset(pLD, LoanStatus == "Past Due (91-120 days")["AmountDelinquent"]
```
It is at most of time just...zero. Let's try it with the current one:

```{r}
subset(pLD, LoanStatus == "Current")["AmountDelinquent"]
```

One way to explain this phenomenon : we better see the label of loan status issued by Prosper during the period of payment. We have no idea how much and when the borrowers don't pay back on time. 

The "Current" status with non-zero amount of delinquency can be explained as well. Since the status is just a label issued by Prosper right on the date the origination of the data set. Besides the status of "Complete", many other labals can be moved to other category as well. A Past-Due borrower may have the hope to move back to the "Current" status when he pay his money back on time again. But how does it happen? We may have no idea at all.


```

# Univariate Analysis

### What is the structure of your dataset?

There are 113,937 credit loans in the dataset 81 features, most of the features can be divided into 4 group:

*About reliability of borrowers
*Valuation about Borrower
*Credit charactoristic
*After the launch of Credit

Other observations:

* Borrowers seem to reveal their own informations in the more ambigous way

* Borrowers prefer to pay the loan in term of 36 / in three years.

* The majority of the loan in the dataset is in the current status


### What is/are the main feature(s) of interest in your dataset?

There are too many variables in the dataset, but by dividing them into  groups, we can simplify the logic we want to combine varables to build predictive models. 


There are actually so many ways to predictive models because of the huge amount of variables. I'd like to determine which feature predicts the number of investors. Because it's the most important for P2P platform to attract their investors in which kind of way. 

Since we want to predict the consideration of investors, first of all we need to know what kinds of elements the investors will notice.

As the website of Prosper shows, there are some variable from our dataset can be found in the informations provided to the investors in the first place:

*Terms
*Credit Grade
*Loan originated Amount
*Lender Yield


I give up including variables of estimated effective Yield and estimated effective loss, althogh this is the first impression provided to the lender as well. Firstly, I don't understand the differences between estimated effective Yield and estimated effective Return. Sometimes they have the same rate, sometimes estimated effective Yield is equal to the sum of estimated loss and return. Secondly, there is no way to figure out which one is the term used by Prosper as "estimated effective Yield" in its website. Thirdly, lots of completed credit have lost the record of estimated Yield.

Lender Yield, as we have analyzed before, performs the similar distrubation like Borrower Rate and Borrower APR and always appear to be non-NaN value which allows us to analyse the dataset without excluding too many data. We should be aware of the same situation happening in using Prosper Rating.

```{r}
nrow(subset(pLD, !is.na(pLD$ProsperRating..numeric.)))
```


Other factors revealed in Prosper like 

* the percentage of funded 
* deadline of funding 
* reasons of borrowing

are not avaliable in our dataset.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

Variables from the group of "About reliability of borrowers" affect the the grading system, which generates the Prosper Rating to remind investors the level of risk. https://www.prosper.com/plp/invest/prosper-ratings/


* Stated Monthly Income
* Employment Status 

Moreover, it will be interesting to compare the predictive performance of Credit Score Range with the Prosper Rating, since it be the factor which manipulate factors like Estimated Loss. Also it covers all the grading in the dataset and displays a complete picture of the dataset.

### Did you create any new variables from existing variables in the dataset?

Yes, I create a new variable named "AverageScore" and "JobOwner"

The first one presents the variety of score range in a way of continuous data, which should be more convienient for us to analyze.

The second helps us to simply distinguish the whether the borrower is a job owner.


### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?



Yes. Some data need to be rescaled for a normal distribution, like the graph of Investors and monetary data like Stated Monthly Income, Loan Original Amount and Open Revolving MonthlyPayment.

The distribution of the variable of investors is strange, even after the transformation of scale, because lots of loan only have one lender or investor.

Some labels of the variable need to be re-factorized, like Income Range, since there are orders between different income ranges.



# Bivariate Plots Section

```{r echo=FALSE, Bivariate_Plots}

#form the new dataset


pLD <- transform(pLD, AverageScore = (CreditScoreRangeLower + CreditScoreRangeUpper)/2)

pLD <- transform(pLD, JobOwner = ifelse(EmploymentStatus == "Employed" | EmploymentStatus == "Full-time" | EmploymentStatus == "Part-time" | EmploymentStatus == "Self-employed", "True", "False"))

simplified_pLD <- pLD[c("Term", "LoanOriginalAmount", "LenderYield", "ProsperRating..numeric.", "ProsperRating..Alpha.", "ProsperScore", "StatedMonthlyIncome", "AverageScore", "JobOwner", "Investors")]



```

Matrix scatterplot
```{r}

```{r}
#exclude the data without filled Prosper Rating
simplified_pLD <- subset(simplified_pLD, ProsperRating..Alpha. != "") 


library(ggplot2)
library(GGally)
library(scales)
library(memisc)

ggpairs(simplified_pLD, 
        lower = list(continuous = wrap("points", shape = I('.'))),
        upper = list(combo = 
                       wrap("box", outlier.shape = I('.'))))
                       
                
```

```{r}
simplified_pLD_numeric <- pLD[c("Term", "LoanOriginalAmount", "LenderYield", "ProsperRating..numeric.", "ProsperScore", "StatedMonthlyIncome", "AverageScore", "Investors")]

cor(simplified_pLD_numeric, use = "complete.obs")
```



From the scatterplot we can observe that it seems the distributions of Terms and Job Owner don't change a lot from their uni-variables form. So I decide not to examine them in detail in this section.

Let's start with the one with the highest correlation with the variable of Investors: Loan Original Amount.



```{r}
ggplot(aes(x = LoanOriginalAmount, y = Investors), data = simplified_pLD) + geom_point()
```

As we have seen before, borrowers prefer borrowing loans with simple whole number, so than we can see some horizontal straight lines formed by the point. Therefore, we should add some jitters. Also, we need to increase the degree of transprancy to avoid the black cluster on the left hand side of the graph.

```{r}
ggplot(aes(x = LoanOriginalAmount, y = Investors), data = simplified_pLD) + geom_point(alpha = 0.05,
             position = position_jitter(w = 500, h = 20)) + scale_x_continuous(limits = c(0, 40000), breaks = seq(0, 40000, 2500)) +
  geom_smooth(method = "lm", se = FALSE) 
```

Even we turn down alpha of the scatterplot and add some jitter points to the graph, the consistency of the horizontal lines like 10000 and 15000 is quite visible. But we should notice as well: 
there is a trend that larger amount of loan needs more investors, as the regression line has suggested. By comparing the graph of univariable graph, we know that actually there more small numbers of loan in the dataset, so the distribution of this two variables graph is not caused by the number of loan.

In our case study, it may mean that our invetors prefer investing relative small amount of money and wait for the other investors rather than throwing lots of money to fullfil the amount requirement in small group of people.


Interesting thing is: the trend seems to stop after the amount of 25000. 

```{r}
ggplot(aes(x = LenderYield, y = Investors), data = simplified_pLD) + geom_point()
```

Again, we need the help of jitter and alpha.

```{r}
ggplot(aes(x = LenderYield, y = Investors), data = simplified_pLD) + geom_point(alpha = 0.05,
             position = position_jitter(h = 25)) +
  geom_smooth(method = "lm", se = FALSE)
```
Athough there is a small correlation (-0.27) between Investors and Lender Yield, lower rate around 0.1 is obviously more popular than 0.3. But why are there fewer investors who are willing to invest for more return?

I think one reason of this is because the return is highly correlated with the risk. There is very high positive correlation between the lender yield and the estimated loss:

```{r}
ggplot(aes(x = LenderYield, y = EstimatedLoss), data = pLD) + geom_point()
with(subset(pLD, !is.na(pLD$EstimatedLoss)), cor(LenderYield, EstimatedLoss))
```


```{r}
fill <- "#4271AE"
line <- "#1F3552"

ggplot(aes(x = ProsperRating..Alpha., y = Investors), data = subset(simplified_pLD, ProsperRating..Alpha. != "")) +
        geom_boxplot(fill = fill, colour = line)
```
fill and line reference: http://t-redactyl.io/blog/2016/04/creating-plots-in-r-using-ggplot2-part-10-boxplots.html



It seems that except with the grade of AA, which is the highest rating, there is no better popularity of investment for the borrowers with higher grade. Most of the boxes just stay at the similar level. But it is mostly because of the outliners. Let we focus the most of the distribution of our data.

```{r}
ggplot(aes(x = ProsperRating..Alpha., y = Investors), data = subset(simplified_pLD, ProsperRating..Alpha. != "")) +
        geom_boxplot(fill = fill, colour = line) + coord_cartesian(ylim=c(0, 300))
```

In general, we can say that better grade can bring more investors, especially from the grade of C to the AA. 

Althoguh the Alpha Rating is not numeric and we can not do correlation calculation with it, the dataset prepare the numeric grading for us, whose "1" represents the worst grade "HR" and "7" the best grade "AA" .

```{r}
with(simplified_pLD, cor(Investors,  ProsperRating..numeric., use = "complete.obs"))
```

But as the correlation number shows, 0.3 is just a bit better than a weak correlation. In the graph, we can see there are some outliners from very bad grade, which attracts huge amount of investors. And the mean number of investors for Grade C is even lower than worse grade.

There is another grading system from Prosper - Prosper Score.

https://www.prosper.com/plp/general-prosper_score/

By reading the explaination from Prosper again, we know the credit score should be so-called "credit bureau score" or "credit reporting agency score". Prosper states that the Prosper Score is specifically "A custom risk score was built using historical Prosper data to assess the risk of Prosper borrower listings. The output to Prosper users is a Prosper score which ranges from 1 to 11, with 11 being the best, or lowest risk, score." In short, it performs a larger spectrum of rating for clearer examination.

The rating grade is certainly presented on the website of Prosper. But will the investor have chance to view the more precise version of score? Very likely and there is strong correlation between these two varibles.

```{r}
#back to the full dataset to analyze the correlation in unfactorized way
with(pLD, cor(ProsperScore,  ProsperRating..numeric., use = "complete.obs"))
```

```{r}

simplified_pLD$ProsperScore <- factor(simplified_pLD$ProsperScore,
                          levels = c(1:11))

ggplot(aes(x = ProsperScore , y = Investors), data = simplified_pLD ) + geom_bar(stat = 'summary', fun.y = mean)

```
```{r}
# come back to the full dataset to use correlaion function since the Prosper Score has been factorized
with(pLD, cor(ProsperScore, Investors, use = "complete.obs"))

```

It performs a little bit better than the traditional grading, but two variables don't act like we expect. The worst grade "1" and the best grade "11" don't attract the smallest and the largest amount of investors.

The document also talk about the advantage of Prosper Score:

"Unlike a credit bureau score, which is based on a much wider variety of loan performance, the Prosper score is specifically built on the Prosper borrower and applicant population. As such, the credit reporting agency score should, and does, rank order risk on the Prosper population, but is not as discriminating as the custom score." 

Although we have no idea where the data of credit score range come from, it is very likely the so-called "credit bureau score" or "credit reporting agency score" since every borrowers gets their credit score in the two variables of credit score range, which is already transformed into the one variable "AverageScore". So how do it performs in predicting the number of investors?

```{r}
ggplot(aes(x = AverageScore , y = Investors), data = simplified_pLD) + geom_histogram(stat = 'summary', fun.y = mean)
```

```{r}
with(simplified_pLD, cor(Investors, AverageScore, use = "complete.obs"))
```

Starting from the average score of 700, the correlation between average score and Investors is very obvious. And it performs even better than the conventional 1-to-7-Rating. But why is the lowest score just about 600? Let's come back to our full dataset:

```{r}
ggplot(aes(x = AverageScore , y = Investors), data = pLD) + geom_histogram(stat = 'summary', fun.y = mean)


with(pLD, cor(Investors, AverageScore, use = "complete.obs"))
```
It performs now below the standard of "good" correlation, i.e. 0.3. As we see in the graph, some borrowers with very low score can still win some investors.

The very low scores are excluded after I filter the full dataset where the Propser conventional Rating is missing, that means, only the one whose credit range is approximately over the level of 600 can carn a prosper score. Otherwise, the value of Prosper's conventional rating will be blank.

It also means that, A HR borrower may be someone who actually earns a average score more than 600. It is very strange. Let's say the most famous credit score -- FICO score, whose ranges from 300 and 850, the level of 600 is actually just a bit worse than having a good credit history.
https://www.investopedia.com/terms/f/ficoscore.asp

```{r}
head(subset(pLD, AverageScore < 600)["CreditGrade"])
```

Some of data which is lower than the level of 600 have Credit Grade. Again, we don't know where does this grade come from. When is it shown? Before the origination of loan? After the origination? Or never and is it just internal record in Prosper's database? 

If it is not shown in front of the investors, how come there is still a correlation between Average Score and number of investors? I think the best explaination is that there is also a relationship between the Prosper Rating (traditional or Prosper Score) and Average Score.

```{r}
with(pLD, cor(ProsperRating..numeric., AverageScore, use = "complete.obs"))
with(pLD, cor(ProsperScore, AverageScore, use = "complete.obs"))
```


The connection between the Average Score and Prosper Rating is stronger than between the Average Score and Prosper Score. Maybe the history of the rating development should be like this:

Credit Grade/Credit Score (from bureau?) --> Prosper conventional rating --> Prosper Score

Since we can sure the last two will be shown in the investors' pages, we should include them if we want to investigate the predictive factor of investors. 

Let's back to the focus on investors. How is the relationship between the Income and number of  Investors?

```{r}
ggplot(aes(x = StatedMonthlyIncome, y = Investors), data = simplified_pLD) + geom_point()
```

There are some super rich people who produce huge outliners on the scatterplot. Let's zoom in a bit:

```{r}
ggplot(aes(x = StatedMonthlyIncome, y = Investors), data = subset(simplified_pLD)) + geom_point(alpha = 0.05,
             position = position_jitter(w = 500, h = 20)) + coord_cartesian(xlim=c(0, 75000))


```

It reminds me the form we have seen in the uni-variable analyze, whose peak appear in the left hand side. We need to add the data into the log10 function again: 

```{r}
ggplot(aes(x = StatedMonthlyIncome, y = Investors), data = subset(simplified_pLD, StatedMonthlyIncome != 0)) + geom_point(alpha = 0.05) +  scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 )  

```

Again, the distribution concentrate around 10^4 like the uni-variable. I think it is just because most of borrowers earn the intermediate income, so most of investors have more chances to invest them. In fact, there are almost no correlation between these two factors.  

```{r}
with(subset(pLD, IncomeVerifiable == "True"), cor(StatedMonthlyIncome, Investors))
```

In fact, there are almost no correlation between these two factors. 

But what is correlation betwwen income and socre? How much do I earn should be related to the score, which affects the investors? In order to have a fair analyse, I add the constraint of "verified income" in the subset in calculating the correlation:

```{r}
with(subset(pLD, IncomeVerifiable == "True"), cor(StatedMonthlyIncome, AverageScore, use = "complete.obs"))

with(subset(pLD, IncomeVerifiable == "True"), cor(StatedMonthlyIncome,ProsperRating..numeric., use = "complete.obs"))

with(subset(pLD, IncomeVerifiable == "True"), cor(StatedMonthlyIncome,ProsperScore, use = "complete.obs"))

```
None of our grading systme seem to have relationship with Income.


```{r}
ggplot(aes(x = StatedMonthlyIncome, y = AverageScore), data = subset(pLD, StatedMonthlyIncome != 0 & IncomeVerifiable == "True")) + geom_point(alpha = 0.05, position = position_jitter(h = 20)) +  scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 )  

```


Reading the document on Prosper again, Key variables of Prosper Score in the scorecard are:

Number of inquiries on the credit bureau
Number of delinquent accounts on the credit bureau
Credit card utilization on the credit bureau
Number of recently opened trades on the credit bureau
Debt to income ratio
Loan payment performance on prior Prosper loans

Although many similiar factors like "previous credit" are included in our dataset, lots of them are just 0 and lack of variety.

It reminds me that we have the variable of "Debt To IncomeRatio". Maybe it can be a better statement since it considers the factor of the proportion between income and loan.

```{r}
with(subset(pLD, IncomeVerifiable == "True"), cor(DebtToIncomeRatio, Investors, use = "complete.obs"))

with(subset(pLD, IncomeVerifiable == "True"), cor(DebtToIncomeRatio, ProsperScore, use = "complete.obs"))
```

It does not perform better. 

It is against my intuition: when we borrow money to the others, we will examine if the borrowers have the ability to pay the money back. 

Then what is the factor which affect the score the most? Then I come back to the matrix of correlation and find the strongest correlation with the score:

```{r}
with(simplified_pLD, cor(LenderYield, ProsperScore, use = "complete.obs"))
```

```{r}
ggplot(aes(x = ProsperRating..numeric., y = LenderYield), data = simplified_pLD) + geom_bar(stat="summary", fun.y=mean) 
```

It prefectly related to........how much can the invesotrs earn?

It should be better to say: the score affects the yield, since people with bad socre should pay more interest. According to the theory in Economics, people with bad credit socre are likely no able to pay back in the future, so they need to pay more to balance the risk and uncertainty in the future. 

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

There are a correlation between the investors and loan original amount, even though the amount number just sticks to a particular number and therefore lacks of variety. It is understandable because large amount of loan needs more people to fill the requirement. It may show that investors want to avoid risk rather than throwing more investments and expecting better returns.

The correlation between investors and lender yield is weak (-0.24232616). The negative correlation indicate that when the lender yield goes up, the number of investors will move down. I think the reason is that higher return also means higher risk as well.


### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

The relationship between the score system, whatever it is from the rating system in Prosper or the "bureau score", and the level of income is almost equal to zero. It doesn't make sense to me because how much borrowers can borrow should be proportional to how much borrowers earn.

### What was the strongest relationship you found?


The relationship between lender yield and Propser conventional rating is very strong, almost reaching the maximum level of correlation. Because the lender yield refers the credit score, since the credit indicates how trustful the borrowers are. If they are more untrustful, then they need to pay more transaction costs.

But again, the question "what affects the score the most?" has not been answered. Assuming the score system is reasonable and it reveals the information the lenders need to know, other factors like the past record determine more and subtle changes like past-due once will make a huge difference in the score or rating.

Since this exploration is focusing the relationship between investors, we will go back to analyzing the main theme in the next section.


# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```


```{r Building the Linear Model}
m1 <- lm(I(log(price)) ~ I(carat^(1/3)), data = diamonds)
m2 <- update(m1, ~ . + carat)
m3 <- update(m2, ~ . + cut)
m4 <- update(m3, ~ . + color)
m5 <- update(m4, ~ . + clarity)
mtable(m1, m2, m3, m4, m5)
names(diamondsbig)
```


# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?




### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

```{r}
#Allocation of Term
ggplot(aes(Term), data = pLD) + geom_bar()
summary(pLD$Term)
ggplot(aes(Term), data = pLD) + geom_bar() + scale_x_continuous(breaks = c(12, 36, 60))

Terms_labels <- pLD %>%
  group_by(Term) %>% summarise('n' = n()) %>% mutate(percent = round(n/nrow(pLD)*100)) %>% mutate(label = paste0(percent, "%")) %>% arrange(percent)


       

Terms_labels$lbls <- paste(Terms_labels$Term, Terms_labels$label, sep="-----")

# ad % to labels 
pie(Terms_labels$n, labels = Terms_labels$lbls, col=rainbow(length(Terms_labels$lbls)))

library(plotrix)
pie3D(Terms_labels$n, labels = Terms_labels$lbls, col=rainbow(length(Terms_labels$lbls)), explode=0.1)
```

```{r}
detail_hiding_2 <- subset(pLD[c("Occupation", "EmploymentStatus")], Occupation == "Other" | Occupation == "Professional")

hiding_occupation_plot_2 <- ggplot(aes(EmploymentStatus), data = detail_hiding_2) + geom_bar() + theme(axis.text.x = element_text(angle = 90, hjust = 1))
hiding_occupation_plot_2
```


```{r}
names(pLD)
```
```{r}
payment <- pLD[c("BorrowerAPR", "LenderYield", "EstimatedEffectiveYield",
                 "EstimatedLoss",
                 "EstimatedReturn",
                 "Term",
                 "LoanOriginalAmount",
                 "MonthlyLoanPayment",
                 "LP_CustomerPayments",
                 "LP_CustomerPrincipalPayments",
                 "LP_InterestandFees",
                 "LP_ServiceFees",
                 "LoanOriginationDate",
                 "LoanMonthsSinceOrigination", "LoanStatus",
                 "ClosedDate", "ProsperRating..Alpha." )]
subset(payment, LoanStatus == "Completed")
pLD[c(924), 1:81]
payment[1:5]
levels(pLD$LoanStatus)
```


```{r}
subset(payment, LoanStatus == "Completed")
```


```{r}
# date comparing
date <- pLD[c(65, 25, 3, 7, 5)]
"LoanOriginationDate"    

[25] "DateCreditPulled" 
"ListingCreationDate"   
"ClosedDate
"Term" 
date_12 <- subset(date, Term == "12")
head(date_12)
```


```{r}
#relationship between credit and terms 

[69] "LP_CustomerPayments"                 "LP_CustomerPrincipalPayments"       
[71] "LP_InterestandFees"                  "LP_ServiceFees"                     
[73] "LP_CollectionFees"                   "LP_GrossPrincipalLoss"              
[75] "LP_NetPrincipalLoss"           

Credit_payment <- subset(pLD[c("LP_CustomerPayments", "MonthlyLoanPayment" , "Term", "LoanStatus")], LoanStatus != "Completed")
Credit_payment <- transform(Credit_payment, Payment_month = LP_CustomerPayments/MonthlyLoanPayment)
head(Credit_payment)

#overdate payment
subset(Credit_payment, Payment_month < Term & LoanStatus == "Defaulted")


#any cost?
subset(pLD, LP_CustomerPayments == 12688.13)
```
The term "delinquent" commonly refers to a situation where a borrower is late or overdue on a payment, such as income taxes, a mortgage, an automobile loan or a credit card account. 


In finance, default is failure to meet the legal obligations (or conditions) of a loan,[1] for example when a home buyer fails to make a mortgage payment, or when a corporation or government fails to pay a bond which has reached maturity.





https://en.wikipedia.org/wiki/Default_(finance)
