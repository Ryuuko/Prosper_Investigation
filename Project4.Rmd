Prosper Loan Exploration by Tat Cheong Chu
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)
library(gridExtra)
library(GGally)
library(scales)
library(memisc)
library(devtools)
library(ggthemr)

```

```{r echo=FALSE, message=FALSE, warning=FALSE, Load_the_Data}
# Load the Data
setwd("C:/Users/apple/Desktop/P4")
pLD <- read.csv('prosperLoanData.csv')

```

This report explores a dataset containing prices and attributes for approximately 113937 issued loan on the P2P platform Prosper.

# Univariate Plots Section

This is the data set which includes 81 variables and it's impossible to investigate all of them. Before starting the detailed plotting section, I would like to categorize them into four main categories in order to understand the differences and relationships between each other. In order to highlight the variables mentioned, I would like to capitalize the first letters of variables in this report.

1. About reliability of borrowers

+ Employment Status
+ Employment Status Duration
+ Occupation
+ Home owner
+ Stated Monthly Income
+ Income Verifiable

These are the factors when we consider if a borrower is able to pay the loan or not. By intuition, someone who owns his own house and has a good job with high income should have the credit with more reputation. 

2. valuation about Borrower

+ Credit Grade
+ Credit Score
+ Prosper Rating
+ Credit Score Range

Except Credit Lines, which only implicitly shows how mucg loan a borrower deserve to have, other variables are just using different ways, or different grading systems established by different organisations, to describe the reputation of the borrower in term of borrowing.

3. Credit charactoristic

+ Borrower APR/RATE/Lender Yield
+ Loan Original Amount
+ Term
+ investor

These variables describe how is the P2P-credit formed.

4. after the launch of Credit

+ Revolving Account
+ Loan Status
+ Delinquencies Amount

These variables happen only after the the credit is issued.

These four categories are actually followed by the time of the launch of credit. From the formation of the personalty of borrowers, to the valuations for them, then the credit will be valued by the investors. At the end, the credit will be issued and the payment begins.

First of all, we start our Uni-variable Plots by following this time line.

## 1. About reliability of borrowers

```{r echo=FALSE, message=FALSE, warning=FALSE}
#EmploymentStatus
ggplot(aes(EmploymentStatus), data = pLD) + geom_bar()
```

The majority of borrowers belong to the "Employed", which is actually an ambiguous term and doesn't tell us whether the borrowers are working on basis of "Part-time" or "Full-time". And "self-employed" can be interpreted as a type of "employed". But as least these four types of "employed" dominate the distribution of the employment status. These four types of people have a job and overwhelmingly represent the majority:

```{r echo=FALSE, message=FALSE, warning=FALSE}
employed <- subset(pLD, EmploymentStatus == "Employed" | EmploymentStatus == 
                     "Full-time" | EmploymentStatus == "Part-time" | 
                     EmploymentStatus == "Self-employed")

nrow(employed)/nrow(pLD)

```

What does it mean with the blank on the left-hand side? Did the borrowers miss filling the statement about their employment status? Let's zoom this kind of "blank" status in:

```{r echo=FALSE, message=FALSE, warning=FALSE}
blank_employment <- subset(pLD, EmploymentStatus == "")
summary(blank_employment$LoanStatus)

```

The interesting thing is that none of these credits is current credit or past due. They are completed, or failures paying the credits in states of defaulted or charged-off, which are "ended" in some sense. This may not be a mere coincidence and later we can see that lots of our data come from current credit.

```{r echo=FALSE, message=FALSE, warning=FALSE}
pLD <- transform(pLD, JobOwner = ifelse(EmploymentStatus == "Employed" | 
                                          EmploymentStatus == "Full-time" | 
                                          EmploymentStatus == "Part-time" | 
                                          EmploymentStatus == "Self-employed", 
                                        "True", "False"))

# EmploymentStatusDuration
ggplot(aes(EmploymentStatusDuration), data = pLD) + 
  geom_histogram() + scale_x_continuous(limits = c(0, 600), 
                                        breaks = seq(0, 600, 30))
```

It presents a very neat trend of the duration. The detail of the trend is that differences between groups of bins become smaller, as the duration goes up, so that we can observe the curve becomes flatter around the left hand side of the graph.

It is reasonable since it may also imply age distribution: the younger you are, the shorter you've worked. Obviously, P2P borrowing is relatively a new concept comparing to the traditional financial instruments, which should be recognized by more young people than elderly.

In order to show the graph in a form of normal distribution, we can sub the x variable into the log function.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(EmploymentStatusDuration), data = pLD) + geom_histogram() +
  scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 
```

Although it shows us a normal distribution, but more data are lost during the process by removing more than 9100 rows of the data set. But it reminds me that even we don't use the method of log function, we still need to remove more than 7000 rows since there is the majority of "NaN values".

* Occupation

```{r echo=FALSE, message=FALSE, warning=FALSE}

occupation_plot <- ggplot(aes(Occupation), data = pLD) + geom_bar() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
occupation_plot
```

Again, there are ambiguous categories. This time, they are "Other" and "Professional" which don't tell a specific name of the jobs. Like the section of "Employment Status", lot of people intend to hide their private information. I wonder if these kinds of borrowers tend to hide the details of these two sections at the same time.

```{r echo=FALSE, message=FALSE, warning=FALSE}
detail_hiding <- subset(pLD[c("Occupation", "EmploymentStatus")], 
                        EmploymentStatus == "Employed")
hiding_occupation_plot <- ggplot(aes(Occupation), data = detail_hiding) + 
  geom_bar() + theme(axis.text.x = element_text(angle = 90, hjust = 1))
hiding_occupation_plot
```

It seems that there are almost no differences between the distribution form. The second one is just like the mini-version of the first one with smaller amount on y-axis. Using ambiguous category may be not a important feature to consider.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#home owner
ggplot(aes(IsBorrowerHomeowner), data = pLD) + geom_bar()

table(pLD$IsBorrowerHomeowner)
```

The differences is about 1000 people, which is less than 1% of the objects in the whole data set.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Income Range

pLD$IncomeRange <- factor(pLD$IncomeRange,
                          levels = c(
    "Not displayed",
    "Not employed",
    "$0",
    "$1-24,999",
    "$25,000-49,999",
    "$50,000-74,999",
    "$75,000-99,999",
    "$100,000+"
    ))
ggplot(aes(IncomeRange), data = pLD) + geom_bar()
```

It seems like a reasonable distribution, because in most of the time, the distribution concentrates to the range of "$25,000-49,999" and "$50,000-74,999", and actually it is the middle of the income range. And we should compare it to the stated monthly income in order to verify the data.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#StatedMonthlyIncome
ggplot(aes(StatedMonthlyIncome), 
       data = subset(pLD, !is.na(StatedMonthlyIncome))) + 
  geom_histogram() + scale_x_continuous(limits = c(0, 40000)) + geom_freqpoly() 
```

It has the similar form of slightly Skewed distribution, which needs the log function to become a normal distribution.

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(aes(StatedMonthlyIncome), 
       data = subset(pLD, !is.na(StatedMonthlyIncome))) + 
  geom_histogram() + scale_x_continuous(limits = c(0, 40000)) + 
                geom_freqpoly() +
   scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(pLD$StatedMonthlyIncome)
```

As we can see most of income amounts don't reach the magnitude of 10^(4). As we can see in the summary, the mean of the data just reach 5608 or approximately 10^(3.74).

But is the data of income reliable? We can limit the data set with the variable of Income Verifiable.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# IncomeVerifiable?

summary(pLD$IncomeVerifiable)
ggplot(aes(IncomeRange), data = subset(pLD, IncomeVerifiable == "True")) + 
  geom_bar()


ggplot(aes(x = StatedMonthlyIncome), data = pLD) + 
  geom_freqpoly(color = "yellow") + scale_x_continuous(limits = c(0, 40000)) + 
  geom_freqpoly(data = subset(pLD, IncomeVerifiable == "True"), 
                aes(color = StatedMonthlyIncome), color = "orange") + 
  theme_minimal()

```

The first picture of our Income Range distribution has no obvious changes. The second picture shows the differences between the original and the one which excludes the unverified data. These two lines show the similar form. It means most of our data about income is trustable.

## 2. Valuation about Borrower

There are three different ways to describe the grading:

* Credit Grade
* Prosper Rating
* Credit Score Range

During my research, no evidence has been found to show that the credit score range in this data set come from the FICO score or Vantage score, which are two of the most famous credit grading, since the range doesn't stay consistent to their standards. (https://www.creditsesame.com/blog/credit/credit-score-range-for-experian-transunion-equifax/, https://your.vantagescore.com/interpret_scores)

First of all, we need to make a subset including these variables or relative variables in order to examine them with a closer look.

```{r echo=FALSE, message=FALSE, warning=FALSE}
grade_comparation <- pLD[c("LoanStatus", "CreditGrade", "ProsperRating..Alpha.", 
                           "ProsperScore", "CreditScoreRangeLower", 
                           "CreditScoreRangeUpper")]
```

The distribution of Credit Score Range Upper when the Credit Grade is equal to E:

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(subset(grade_comparation, CreditGrade == "E")$CreditScoreRangeUpper)
```

When the Credit Grade is equal to D:

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(subset(grade_comparation, CreditGrade == "D")$CreditScoreRangeUpper)
```

When the Credit Grade is equal to C:

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(subset(grade_comparation, CreditGrade == "C")$CreditScoreRangeUpper)
```

Although we don't know from what kind of institution the credit grade was issued, according to the common definition of credit grade, we know that the grade of E to A represents the credit reputation from bad to the better position. The only one which is worse than E is the grade of HR.

As we can see, the credit score range seems to relate to the credit grade, as the credit grade goes up, the range of credit score goes up as well.

But it is a different story when we examine the rating from Prosper:

When the Credit Grade is equal to E:

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(subset
        (grade_comparation, ProsperRating..Alpha. == "E")$CreditScoreRangeUpper)
```

When the Credit Grade is equal to D:

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(subset(
  grade_comparation, ProsperRating..Alpha. == "D")$CreditScoreRangeUpper)
```

When the Credit Grade is equal to C:

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(subset(
  grade_comparation, ProsperRating..Alpha. == "C")$CreditScoreRangeUpper)
```

From the grade of E to C, they share the same minimum range of credit score. The maximum score of grade C is just a little bit higher than D and E.

We can examine the differences between these two systems of rating by using graphs:

```{r echo=FALSE, message=FALSE, warning=FALSE}
pLD$CreditGrade <- factor(pLD$CreditGrade,
                          levels = c(
 "", "NC", "HR", "E", "D", "C", "B", "A", "AA" 
    ))
ggplot(aes(CreditGrade), data = pLD) + geom_bar() 
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
pLD$ProsperRating..Alpha. <- factor(pLD$ProsperRating..Alpha.,
                          levels = c(
 "", "HR", "E", "D", "C", "B", "A", "AA" 
    ))
ggplot(aes(ProsperRating..Alpha.), data = pLD) + geom_bar() 
```

So why is the "Null value" also the largest part in these two graphs? It is found that all of the credit grade are only applied to the "ended" loan but never to the current loan.

```{r echo=FALSE, message=FALSE, warning=FALSE}
non_null_CreditGrade <- subset(pLD, CreditGrade != "")
summary(non_null_CreditGrade$LoanStatus)
```

At the first time, I thought that the credit grade was only applied to the "ended" credit. So it is reasonable to assume the Prosper rating only reveals the current credit. But: it isn't. It includes all kinds of situation:

```{r echo=FALSE, message=FALSE, warning=FALSE}
non_null_ProsperRating <- subset(pLD, ProsperRating..Alpha. != "")
summary(non_null_ProsperRating$LoanStatus)
```

And there is no a single row of data which consist two grading.

```{r echo=FALSE, message=FALSE, warning=FALSE}
Rating_same_time <- subset(pLD, ProsperRating..Alpha. != "" & CreditGrade != "")
nrow(Rating_same_time)
```

The weirder thing is : the score range is always filled and has no any null value.

*Any null lower score?*

```{r echo=FALSE, message=FALSE, warning=FALSE}
null_lower_score <- subset(pLD, CreditScoreRangeLower == "")
nrow(null_lower_score)

```

*Any null upper score?*

```{r echo=FALSE, message=FALSE, warning=FALSE}
null_upper_score <- subset(pLD, CreditScoreRangeUpper == "")
nrow(null_upper_score) 
```

That means we can have the whole picture of the data set via the credit score range:

```{r echo=FALSE, message=FALSE, warning=FALSE}
# sum up and take the average number of the score range to help building better  
# view of scope
pLD <- transform(pLD, AverageScore = 
                   (CreditScoreRangeLower + CreditScoreRangeUpper)/2)

#ignore the extreme low value of credit to have better view of the histogram
ggplot(aes(AverageScore), data = pLD) + geom_histogram() + 
  scale_x_continuous(limits = c(350, 1000), breaks = seq(0, 1000, 125)) 

```

To conclude from these results:

Firstly, When we want to investigate the credit performance of all the borrowers, we can use average score of the score range. Although the source of the score is unknown, it covers all the data of borrowers. 

In principle, the rating from Prosper is less believable because the rating is displayed on the homepage of the Prosper for investors to choose the products,which means the rating may not be accurate to represent the credibility of the borrowers, but may consider making some investment more attractive. We can investigate it in the Bi-variate Analysis section. (https://www.prosper.com/invest)

Secondly, When we want to investigate the relationship between the rating and the number of investors, we should use the Prosper Rating. As we just discussed, the rating is revealed as the important part of description of the borrower's status. But we should be careful to use it since it's limited to the current loan.

##3.  Credit charactoristic

* Borrower APR/RATE/Lender Yield

Actually these three variables describe the same thing on three different angles: interest rate.

The differences between Lender Yield and Borrower Rate is "a servicing fee charged by the originator to the investor each time a payment is made".(https://www.orchardplatform.com/blog/2014519lender-yield-prosper/, it seems that it is using the same Prosper Data set as well.)

The "originator" here is Prosper.

Moreover, the borrowers need to pay the extra fee to the originator/Prosper. That is the differences between Borrower APR and Borrower Rate. The first one includes "other charges or fees such as mortgage insurance, most closing costs, discount points and loan origination fees."(https://www.bankofamerica.com/mortgage/learn/apr-vs-interest-rate/)

So, the relationship between Borrower APR and Lender Yield should be like this:

Borrower APR = Lender Yield +  extra fee paid by investors/lenders + extra fee paid by borrowers
 
So we can be sure that all the rate generally will move higher by following the order of "Lender Yield < Borrower Rate < Borrower APR".

```{r echo=FALSE, message=FALSE, warning=FALSE}

theme_set(theme_grey())

LY <- ggplot(aes(LenderYield), data = pLD) + geom_histogram() + 
  scale_x_continuous(limits = c(0, 0.4), breaks = seq(0, 0.4, 0.05))

BR <- ggplot(aes(BorrowerRate), data = pLD) + geom_histogram() + 
  scale_x_continuous(limits = c(0, 0.4), breaks = seq(0, 0.4, 0.05))

BA <- ggplot(aes(BorrowerAPR), data = pLD) + geom_histogram() + 
  scale_x_continuous(limits = c(0, 0.4), breaks = seq(0, 0.4, 0.05))

grid.arrange(LY, BR, BA, ncol = 1)

```

Both of the extra fees, are in most of the time "irregular" and depend on the the condition of investors and borrowers, so that we can see the form of three graphs have subtle differences on their distributions, but the trend of moving the bar towards the right hand side is still obvious, especially the "shift" happening on the graph of Borrower APR.

In order to gain a greater overview upon the interest, we can also put variables in the same graph.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(pLD, aes(x = LenderYield, y = ..count.., color = "Lender Yield")) + 
  geom_freqpoly() +
  geom_freqpoly(aes(x = BorrowerRate, y = ..count.., color = "Borrower Rate")) +
  geom_freqpoly(aes(x = BorrowerAPR, y = ..count.., color = "Borrower APR")) + 
  xlab("Rate Comparation") + guides(color=guide_legend(title="Type of Rate"))  
```

* Loan Original Amount

Next question is: how much have the borrowers borrowed?

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(aes(LoanOriginalAmount), data = pLD) + geom_histogram(bins= 100) + 
  scale_x_continuous(limits = c(0, 40000), breaks = seq(0, 40000, 2500))

```

It is a different distribution than the interest rate which is calculated with the specific formula and weight. This one is chosen by the human borrowers and it is clear that some of amounts or numbers are popular among the others.

```{r echo=FALSE, message=FALSE, warning=FALSE}
dataSummary <- pLD  %>%
  group_by(LoanOriginalAmount) %>% summarise(n = n())

dataSummary <- dataSummary[order(-dataSummary$n),] 

head(dataSummary)
```

As we can see, borrowers raise their request with the simple whole numbers. It is quite understandable since borrowers don't know how much they need to finance their businesses so exactly.

* Term

There are three types of term in the data set: 12, 36 and 60. The number actually represents the payment duration options provided by Prosper: in how many months a borrower need to pay back the credit or so-called a monthly loan payment. 

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(aes(Term), data = pLD) + geom_bar() + 
  scale_x_continuous(breaks = c(12, 36, 60))

Terms_labels <- pLD %>%
  group_by(Term) %>% summarise('n' = n()) %>% 
  mutate(percent = round(n/nrow(pLD)*100)) %>% 
  mutate(label = paste0(percent, "%")) %>% arrange(percent)

ggplot(data = Terms_labels, aes(x=factor(1), , y=n, fill=factor(Term))) + 
  geom_bar(width = 1, stat = "identity") + coord_polar(theta="y") + 
  geom_text(aes(x=1, y = cumsum(n) - n/2, label = label))
```

The preference of 3-year loan dominates the majority of the borrowers.

* investor

Investors or lenders lend the money to the borrowers on the platform of Prosper.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(Investors), data = pLD) + geom_histogram() + 
  scale_x_continuous(limits = c(0, 600), breaks = seq(0, 600, 30)) + scale_y_continuous(limits = c(0, 15000))
```

As we are having a uni-variable analyse, the changes of x axis/exogenous variable result in the y axis/endogenous variable. Here the endogenous variable shows how many credit are lended. The graph shows us a negative correlation. When the number of investors goes up, the number of credit goes down at the same time.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(Investors), data = pLD) + geom_histogram() + scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 

```

Interesting thing happens when we put them into the log function: Firstly, around the range from 10^(0.5) to (10^3), we have a normal distribution with high variance, so that the distribution looks flatter. Secondly, the majority of investors just reaches the magnitude of 10^0, which means 1! 

```{r echo=FALSE, message=FALSE, warning=FALSE}
summary(pLD$Investors)
```

As the summary shows, the mean is near to the level of 10^2, which forms the "pike" in the form of normal distribution. 

The minimum number of the data set is only 1 and its first quarter is just 2. It is because there are lots of small amounts of investors in the data set.

So, how many borrower only gets one investor?

```{r echo=FALSE, message=FALSE, warning=FALSE}
nrow(subset(pLD, Investors == "1"))/nrow(pLD)
```

Almost a quarter.

## 4. After the launch of Credit

* Revolving Account

According to the definition from Wikipedia, A revolving account is "an account created by a lender to represent debts where the outstanding balance does not have to be paid in full every month by the borrower to the lender."(https://en.wikipedia.org/wiki/Revolving_account)

But it has its limitation and the borrowers should pay the principal and interest for what he owned in the following month.(http://blog.credit.com/2013/04/how-a-revolving-credit-account-works-65670/)

I have not heard of this term before, but to my own opinion, it creates an account to help the borrowers to delay their payment. It is an interesting payment strategy to avoid damaging the reputation or the credit grade of the borrower without paying on time.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(OpenRevolvingMonthlyPayment), data = pLD) + geom_histogram() + 
  scale_x_continuous(limits = c(0, 2000), breaks = seq(0, 2000, 100)) + 
  scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 

summary(pLD$OpenRevolvingMonthlyPayment)
```

People seem only afford a small amount of credit around 100 to 1000 in order to keep their record. So do most of them pay the credit on time? Let's see the distribution of Loan Status.

* Loan Status

According to the definition from this website(https://www.orchardplatform.com/blog/understanding-loan-statuses/)shows us the different types of loan status:

++ Completed: fully paid off

++ Final Payment in Progress: move to the completed status within the next period

++ Current: making payments on time

++ Past Due: payment is missed

++ Charge Off: After 4 missed payments, the status of "current" will move to "charge-off". In this situation, the investment is assumed to be lost.

++ Defaulted: reasons like bankruptcy make the borrowers fail to make the payment

```{r echo=FALSE, message=FALSE, warning=FALSE}

pLD$LoanStatus <- factor(pLD$LoanStatus,
                          levels = c(
    "Cancelled",
    "Current",
    "Completed",
    "Past Due (1-15 days)",
    "Past Due (16-30 days)",
    "Past Due (31-60 days)",
    "Past Due (61-90 days)",
    "Past Due (91-120 days)",
    "Past Due (>120 days)",
    "Chargedoff",
    "Defaulted"
    ))


ggplot(aes(LoanStatus), data = pLD) + geom_bar() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Most of the loans is either completed or current. But the category of "Past Due (>120 days)" makes me curious. According to the definition, the column of "Past Due (>120 days)" should not exist because Past Due which is longer than 120 days should be categorized as Charged-off. Some said it is more than 180 Days.(https://www.thebalance.com/deal-with-past-due-accounts-961128 / https://en.wikipedia.org/wiki/Charge-off)

```{r echo=FALSE, message=FALSE, warning=FALSE}
nrow(subset(pLD, LoanStatus == "Past Due (>120 days)"))
```

The number of "Past Due (>120 days)" is only 16, which is extremely small number comparing to the whole data set, so it is almost unobservable in the graph of Loan Status. 

How about putting it in another way: maybe the borrowers with charge off may owe more money? 

We have the variable of "Amount of Delinquencies" to investigate. Delinquent "is an individual or corporation with a contractual obligation to make payments against a loan in a timely manner, such as through a mortgage, but payments are not made on time."(https://www.investopedia.com/terms/d/delinquent.asp)

How much is the amount of delinquency when the status is charged-off?

```{r echo=FALSE, message=FALSE, warning=FALSE}
head(subset(pLD, LoanStatus == "Chargedoff")["AmountDelinquent"])
```

And How much is the amount of delinquency when the status is Past Due (91-120 days)?

```{r echo=FALSE, message=FALSE, warning=FALSE}
head(subset(pLD, LoanStatus == "Past Due (91-120 days)")["AmountDelinquent"])
```

It is at most of time just...zero. Let's try it with the current status:

```{r echo=FALSE, message=FALSE, warning=FALSE}
head(subset(pLD, LoanStatus == "Current")["AmountDelinquent"])
```

There is one way to explain this phenomenon : we just see the label of loan status issued by Prosper during the period of payment. We have no idea how much and when the borrowers don't pay back on time. 

The "Current" status with non-zero amount of delinquency can be explained as well. Since the status is just a label issued by Prosper right on the date of the origination of the data set. Besides the status of "Complete", many other labels can be moved to other categories as well. A Past-Due borrower may have the hope to move back to the "Current" status when he pay his money back on time again. But how does it happen? We may have no idea at all.

# Univariate Analysis

### What is the structure of your dataset?

There are 113,937 credit loans in the dataset with 81 features, most of the features can be divided into 4 group:

* About reliability of borrowers
* Valuation about Borrower
* Credit charactoristic
* After the launch of Credit

Other observations:

* Borrowers seem to reveal their own informations in the an ambiguous way.

* Borrowers prefer to pay the loan in term of 36, which is three-year.

* The majority of the loan in the data set is in the current status.

### What is/are the main feature(s) of interest in your dataset?

There are too many variables in the dataset, but by dividing them intogroups, we can simplify the logic we want to combine varables to build predictive models. 

There are actually so many ways to do so because of the huge amounts of variables. I'd like to determine which feature predicts the number of investors. Because it's the most important for the P2P platform to attract their investors in which kind of way. 

Since we want to predict the consideration of investors, first of all we need to know what kinds of elements the investors will notice.

```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('C:/Users/apple/Desktop/P4/prosper_as_investors.PNG')
```

As the website of Prosper shows, there are some variables from our dataset can be found in the informations provided to the investors in the first place:

* Terms
* Credit Grade
* Loan originated Amount
* Lender Yield

I give up including variables of Estimated Effective Yield and Estimated Effective loss, althogh this may be the first impression provided to the lender as well. Firstly, I don't understand the differences between Estimated Effective "Yield" and Estimated Effective "Return". Sometimes they have the same rate, sometimes Estimated Effective Yield is equal to the sum of Estimated Loss and return. Secondly, there is no way to figure out which one is the term used by Prosper as "Estimated Effective Yield" in its website. 

```{r echo=FALSE, out.width='100%'}
knitr::include_graphics('C:/Users/apple/Desktop/P4/information_to_the investors.PNG')
```

Thirdly, lots of completed credit have lost the record of Estimated Yield, Loss and Return

Lender Yield, as we have analyzed before, performs the similar distrubation like Borrower Rate and Borrower APR and always appear to be non-NaN value which allows us to analyse the dataset without excluding any data. We should be aware of the same situation happening in using Prosper Rating.

```{r echo=FALSE, message=FALSE, warning=FALSE}
nrow(subset(pLD, !is.na(pLD$ProsperRating..numeric.)))
```

Other factors revealed in Prosper like 

* the percentage of funded 
* deadline of funding 
* reasons of borrowing

are not avaliable in our dataset.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

Variables from the group of "About reliability of borrowers" affect the grading system, which generates the Prosper Rating to remind investors the level of risk.(https://www.prosper.com/plp/invest/prosper-ratings/) Variables like:

* Stated Monthly Income
* Employment Status 

may be useful to our analyze.

Moreover, it will be interesting to compare the predictive performance of Credit Score Range with the Prosper Rating, since it is the factor which manipulates factors like Estimated Loss. Also it covers all the grading in the dataset and displays a complete picture of the dataset.

### Did you create any new variables from existing variables in the dataset?

Yes, I create new variables named "AverageScore" and "JobOwner"

The first one presents the variety of score range in a way of continuous data, which should be more convienient for us to analyze.

The second one helps us to simply distinguish whether the borrower is a job owner.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

Yes. Some data need to be rescaled for a normal distribution, like the graph of Investors and monetary data like Stated Monthly Income, Loan Original Amount and Open Revolving Monthly Payment.

The distribution of the variable of investors is strange, even after the transformation of scale, because lots of loan only have one lender or investor.

Some labels of the variables need to be re-factorized, like Income Range, since there are orders between different income ranges.

# Bivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots}

#form a simplified dataset

pLD <- transform(pLD, AverageScore = 
                   (CreditScoreRangeLower + CreditScoreRangeUpper)/2)

pLD <- transform(pLD, JobOwner = ifelse(EmploymentStatus == "Employed" | 
                                          EmploymentStatus == "Full-time" | 
                                          EmploymentStatus == "Part-time" | 
                                          EmploymentStatus == "Self-employed", 
                                        "True", "False"))

simplified_pLD <- pLD[c("Term", "LoanOriginalAmount", "LenderYield", 
                        "ProsperRating..numeric.", "ProsperRating..Alpha.", 
                        "ProsperScore", 
                        "StatedMonthlyIncome", "AverageScore", "JobOwner", 
                        "Investors")]

```

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=15}
#exclude the data without filled Prosper Rating
simplified_pLD <- subset(simplified_pLD, ProsperRating..Alpha. != "") 

ggpairs(simplified_pLD, 
        lower = list(continuous = wrap("points", shape = I('.'))),
        upper = list(combo = 
                       wrap("box", outlier.shape = I('.'))))
                       

```

```{r echo=FALSE, message=FALSE, warning=FALSE}
simplified_pLD_numeric <- pLD[c("Term", "LoanOriginalAmount", "LenderYield", 
                                "ProsperRating..numeric.", "ProsperScore", 
                                "StatedMonthlyIncome", 
                                "AverageScore", "Investors")]

cor(simplified_pLD_numeric, use = "complete.obs")
```

From the scatter plot we can observe that it seems that the distributions of Terms and Job Owner don't change a lot from their uni-variable form. So I decide not to examine them in this section.

Let's start with the one with the highest correlation with the variable of Investors: Loan Original Amount.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = LoanOriginalAmount, y = Investors), data = simplified_pLD) + 
  geom_point()
```

As we have seen before, borrowers prefer borrowing loans with simple whole numbers, so that we can see some horizontal straight lines formed by the points. Therefore, we should add some random small adjustments to them by using jitter, so that we can see more distract points rather than a single line. Also, we need to increase the degree of transparency to avoid the black cluster on the left hand side of the graph.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = LoanOriginalAmount, y = Investors), data = simplified_pLD) + 
  geom_point(alpha = 0.05,
             position = position_jitter(w = 500, h = 20)) + 
  scale_x_continuous(limits = c(0, 40000), breaks = seq(0, 40000, 2500)) + 
  geom_smooth()  
```

Even we turn down the alpha grade of the scatter plot and add some jitter points to the graph, the consistency of the horizontal lines like 10000 and 15000 is quite visible. But we should also notice: there is a trend that a larger amount of loan needs more investors, as the regression line has suggested. By comparing the graph of the uni-variable graph, we know that actually there more small numbers of loan in the data set, so the distribution of this two variables graph is not caused by the number of loan.

In our case study, it may mean that our investors prefer investing relative small amount of money and wait for the other investors rather than throwing lots of money to fulfill the amount requirement with small group of people.

Interesting thing is: the trend seems to stop after the amount of 25000. 

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = LenderYield, y = Investors), data = simplified_pLD) + 
  geom_point()
```

Again, we need the help of jitter and alpha.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = LenderYield, y = Investors), data = simplified_pLD) + 
  geom_point(alpha = 0.05,
             position = position_jitter(h = 25)) +
  geom_smooth(method = "lm", se = FALSE)
```

Although there is a weak correlation (-0.27) between Investors and Lender Yield, lower rate around 0.1 is obviously more popular than 0.3. But why are there fewer investors who are willing to invest for more return?

I think one reason of this is because the return is highly correlated with the risk. There is very high positive correlation between the Lender Yield and the Estimated Loss(although we have excluded lots of the data points in  the following graph):

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = LenderYield, y = EstimatedLoss), data = pLD) + geom_point()
with(subset(pLD, !is.na(pLD$EstimatedLoss)), cor(LenderYield, EstimatedLoss))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
fill <- "#4271AE"
line <- "#1F3552"

ggplot(aes(x = ProsperRating..Alpha., y = Investors), 
       data = subset(simplified_pLD, ProsperRating..Alpha. != "")) +
        geom_boxplot(fill = fill, colour = line)
```

First of all, thanks for Jodie Burchell by refering his setting on colors and lines in this graph :(http://t-redactyl.io/blog/2016/04/creating-plots-in-r-using-ggplot2-part-10-boxplots.html)

It seems that except with the grade of AA, which is the highest rating, there is no better popularity of investment for the borrowers with higher grade. Most of the boxes just stay at the similar level. But it is mostly because of the outliers. Let we focus the most of the distribution of our data.

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = ProsperRating..Alpha., y = Investors), 
       data = subset(simplified_pLD, ProsperRating..Alpha. != "")) +
        geom_boxplot(fill = fill, colour = line) + 
  coord_cartesian(ylim=c(0, 300))
```

In general, we can say that better grade can bring more investors, especially from the range of grade of C to the AA. 

Although the Alpha Rating is not numeric and we can not do correlation calculation with it, the data set prepares the numeric grading for us, whose "1" represents the worst grade "HR" and "7" the best grade "AA" . Its correlation with number of Investors is:

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(simplified_pLD, cor(Investors,  ProsperRating..numeric., 
                         use = "complete.obs"))
```

But as the correlation number shows, 0.3 is just a bit better than a weak correlation. In the graph, we can see there are some outliers from very bad grade, which attracts huge amounts of investors. And the mean number of investors for Grade C is even lower than worse grade.

There is another grading system from Prosper - Prosper Score.(https://www.prosper.com/plp/general-prosper_score/)

By reading the explanation from Prosper again, we know that the credit score should be so-called "credit bureau score" or "credit reporting agency score". Prosper states that the Prosper Score is specifically "A custom risk score was built using historical Prosper data to assess the risk of Prosper borrower listings. The output to Prosper users is a Prosper score which ranges from 1 to 11, with 11 being the best, or lowest risk, score." In short, it performs a larger spectrum of rating for a clearer examination.

The rating grade is certainly presented on the website of Prosper. But will the investor have the chance to view more precise version of score? Very likely and there is a strong correlation between these two variables.

```{r echo=FALSE, message=FALSE, warning=FALSE}
#back to the full dataset to analyze the correlation in unfactorized way
with(pLD, cor(ProsperScore,  ProsperRating..numeric., use = "complete.obs"))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}

simplified_pLD$ProsperScore <- factor(simplified_pLD$ProsperScore,
                          levels = c(1:11))

ggplot(aes(x = ProsperScore , y = Investors), data = simplified_pLD ) + 
  geom_bar(stat = 'summary', fun.y = mean)

```
```{r echo=FALSE, message=FALSE, warning=FALSE}
# come back to the full dataset to use correlaion function since the Prosper 
# Score has been factorized
with(pLD, cor(ProsperScore, Investors, use = "complete.obs"))

```

It performs a little bit better than the traditional grading, but two variables don't act like we expect. The worst grade "1" and the best grade "11" don't attract the smallest and the largest amount of investors.

The document also talk about the advantage of Prosper Score:

"Unlike a credit bureau score, which is based on a much wider variety of loan performance, the Prosper score is specifically built on the Prosper borrower and applicant population. As such, the credit reporting agency score should, and does, rank order risk on the Prosper population, but is not as discriminating as the custom score." 

Although we have no idea where the data of credit score range come from, it is very likely the so-called "credit bureau score" since every borrower gets his credit score in the two credit score ranges, which are already transformed into the one variable "Average Score". So how does it perform in predicting the number of investors?

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = AverageScore , y = Investors), data = simplified_pLD) + 
  geom_histogram(stat = 'summary', fun.y = mean)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(simplified_pLD, cor(Investors, AverageScore, use = "complete.obs"))
```

Starting from the average score of 700, the correlation between average score and Investors is very obvious. And it performs even better than the conventional 1-to-7-Rating. But why is the lowest score just about 600? Let's come back to our full data set:

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = AverageScore , y = Investors), data = pLD) + 
  geom_histogram(stat = 'summary', fun.y = mean)


with(pLD, cor(Investors, AverageScore, use = "complete.obs"))
```

It performs now below the standard of "good" correlation, i.e. 0.3. As we see in the graph, some borrowers with very low scores can still win some investors.

The very low scores are excluded after I filter the full data set where the Prosper conventional Rating is missing, that means, only the one whose credit range is approximately over the level of 600 can own a prosper score. Otherwise, the value of Prosper's conventional rating will be blank.

It also means that, A HR borrower may be someone who actually earns an average score more than 600. It is very strange because let's say the most famous credit score -- FICO score, whose ranges from 300 to 850, the level of 600 is actually just a bit worse than having a good credit history.
https://www.investopedia.com/terms/f/ficoscore.asp

```{r echo=FALSE, message=FALSE, warning=FALSE}
head(subset(pLD, AverageScore < 600)["CreditGrade"])
```

Some of data which have lower than the level of 600 have Credit Grade. Again, we don't know where does this grade come from. And when was it generated? Before the origination of loan? After the origination? Or never and is it just an internal record in Prosper's database? 

If it is not shown in front of the investors, how come there is still a correlation between Average Score and number of investors? I think the best explanation is that there is also a relationship between the Prosper Rating (traditional or Prosper Score) and Average Score. The first one is the corrletation between Prosper conventional Rating (1 to 7 version) and Average Score; the second one is between Prosper Score (1 to 11 version) and Average Score:

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(pLD, cor(ProsperRating..numeric., AverageScore, use = "complete.obs"))
with(pLD, cor(ProsperScore, AverageScore, use = "complete.obs"))
```

The connection between the Average Score and Prosper Rating is stronger than between Average Score and Prosper Score. Maybe the history of the rating development should be like this:

Credit Grade/Credit Score (from bureau?) --> Prosper conventional rating --> Prosper Score

Since we can be sure that the last two will be shown in the investors' pages, we should include them if we want to investigate the predictive factor of investors. 

Let's back to the focus on investors. How is the relationship between the Monthly Income and number of Investors?

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = StatedMonthlyIncome, y = Investors), data = simplified_pLD) + 
  geom_point()
```

There are some super rich people who produce huge outliers on the scatter plot. Let's zoom in a little bit:

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = StatedMonthlyIncome, y = Investors), data = 
         subset(simplified_pLD)) + geom_point(alpha = 0.05,
             position = position_jitter(w = 500, h = 20)) + 
  coord_cartesian(xlim=c(0, 75000))

```

It reminds me that the form we have seen in the uni-variable analyze, whose peak appears in the left hand side. We need to add the data into the log10 function again: 

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = StatedMonthlyIncome, y = Investors), data = 
         subset(simplified_pLD, StatedMonthlyIncome != 0)) + 
  geom_point(alpha = 0.05) +  scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 )  

```

Again, the distribution concentrate around 10^4 like the uni-variable. I think it is just because most of borrowers earn the intermediate income, so most of investors have more chances to invest in these people's loans. In fact, there are almost no correlation between these two factors.  

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(subset(pLD, IncomeVerifiable == "True"), cor(StatedMonthlyIncome, Investors))
```

But how is correlation between Monthly Income and score? How much do I earn should be related to the score, which affects the investors? In order to have a fair analyse, I only include the verified Income data in the subset during calculating the correlation:

Correlation with Prosper Conventional Rating:

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(subset(pLD, IncomeVerifiable == "True"), 
     cor(StatedMonthlyIncome,ProsperRating..numeric., use = "complete.obs"))
```

Correlation with Prosper Score:

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(subset(pLD, IncomeVerifiable == "True"), 
     cor(StatedMonthlyIncome,ProsperScore, use = "complete.obs"))

```

Correlation with Average Score:

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(subset(pLD, IncomeVerifiable == "True"), 
     cor(StatedMonthlyIncome, AverageScore, use = "complete.obs"))
```

None of our grading systems seem to have the relationship with Monthly Income.

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(aes(x = StatedMonthlyIncome, y = AverageScore), data = 
         subset(pLD, StatedMonthlyIncome != 0 & IncomeVerifiable == "True")) + 
  geom_point(alpha = 0.05, position = position_jitter(h = 20)) +  scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) 

```

Reading the document on Prosper again, Key variables of Prosper Score in the scorecard are:

* Number of inquiries on the credit bureaus
* Number of delinquent accounts on the credit bureau
* Credit card utilization on the credit bureau
* Number of recently opened trades on the credit bureau
* Debt to income ratio
* Loan payment performance on prior Prosper loans

Although many similar factors like "previous credit" are included in our data set, lots of them are just 0 and lack of variety.

It reminds me that we have the variable of "Debt To Income Ratio". Maybe it can be a better statement since it considers the factor of the proportion between income and loan.

Correlation with Investors:

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(subset(pLD, IncomeVerifiable == "True"), cor(DebtToIncomeRatio, Investors, 
                                                  use = "complete.obs"))
```

Correlation with Prosper Score:

```{r echo=FALSE, message=FALSE, warning=FALSE}
with(subset(pLD, IncomeVerifiable == "True"), cor(DebtToIncomeRatio, 
                                                  ProsperScore, 
                                                  use = "complete.obs"))
```

It does not perform better. 

It is against my intuition: when we len money to the others, we will examine if the borrowers have the ability to pay the money back. 

Then what is the factor which affects the score the most? Then I come back to the matrix of correlation and find the strongest correlation with the score: The Lender Yield.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# back to the full dataset to analyze the correlation in unfactorized way
with(pLD, cor(LenderYield, ProsperScore, use = "complete.obs"))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = ProsperRating..numeric., y = LenderYield), 
       data = simplified_pLD) + geom_bar(stat="summary", fun.y=mean) 
```

It perfectly related to......how much can the investors earn?

It should be better to say: the score affects the yield, since people with bad score should pay higher interests. According to the theory in Economics, people with bad credit score are likely not able to pay back in the future, so they need to pay more to balance the risk and uncertainty in the future. 

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

There are a correlation between the investors and loan original amount, even though the amount number just sticks to a particular number and therefore lacks of variety. It is understandable because large amount of loan needs more people to fill the requirement. It may show that investors want to avoid risk rather than throwing more investments and expecting better returns.

The correlation between investors and lender yield is weak (-0.24232616). The negative correlation indicate that when the lender yield goes up, the number of investors will move down. I think the reason is that higher return also means higher risk.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

The relationship between the score system, whatever it is from the rating system in Prosper or the "bureau score", and the level of income is almost equal to zero. It doesn't make sense to me because how much borrowers can borrow should be proportional to how much borrowers can earn.

### What was the strongest relationship you found?

The relationship between Lender Yield and Prosper Conventional Rating is very strong, almost reaching the maximum level of correlation. Because at the first beginning, the Lender Yield refers to the Credit Score, since the credit indicates how trustful the borrowers are. If they are more untrustful, then they need to pay more transaction costs.

But again, the question "what affects the score most?" has not been answered. Assuming the score system is reasonable and it reveals the information the lenders need to know, other factors like the past record determine more and subtle changes like past-due once will make a huge difference in the score or rating.

Since this exploration is focusing the relationship between investors and other variables, we will go back analyzing the main theme in the next section.

# Multivariate Plots Section

```{r echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots}
ggthemr('grape')
ggplot(aes(x = LoanOriginalAmount, y = Investors, 
           color = ProsperRating..Alpha.), data = subset(simplified_pLD, ProsperRating..Alpha.!= "")) + geom_point(
             position = position_jitter(w = 500, h = 20)) + 
  scale_color_brewer(type = 'seq', 
                     guide = guide_legend(title = "Prosper Rating", 
                                          override.aes = 
                                            list(alpha = 1, size = 2), 
                                          reverse=T)) 
```

High grades like AA and A, whose colors are the darkest, spread within different loan amount and numbers of investors in the whole pictures. Though some of them may not attract large of amount of investors, they generally gain more investors than the others with the same amount of loan. Especially for the loan amount over than 25000, a A-Grade borrower need more investors likely than a B-Grade borrower.

Grade of E and HR, whose colors are the lightest, spread only around the area of low loan amount and stop at some amountx. 

In order to see the exact differences between those grades, we can split the data into 7 blocks according to their grades:

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(aes(x = LoanOriginalAmount, y = Investors), 
       data = subset(simplified_pLD, ProsperRating..Alpha.!= "")) + 
  facet_wrap( ~ ProsperRating..Alpha.) + geom_point()
```

The most obvious differences of grades is that the better grades will borrow more money than the worse. I suspect it is a kind of a policy which limits the low grade borrowers to borrowe more money. Borrowers with D-grade stop at the amount of 15000 and the one with C-grade at 25000 with the very clean horizontal lines.

Secondly, if the borrower gain a grade lower than or equal to D, he/she is impossible to gain more than 500 investors, at least base on the past data.

Thirdly, it is interesting that AA-grade borrowers are not "active" to borrow loan which is more than 25000.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# using the full dataset since the prosper score is factorized. It will be 
# better to present the data in continuous legend, even we know the score is 
# discrete, because it will difficult to read if we turn them into 11 different 
# colors

ggthemr_reset()

ggplot(aes(x = LoanOriginalAmount, y = Investors, color = ProsperScore), 
       data = subset(pLD, ProsperRating..Alpha.!= "")) + 
  geom_point(position = position_jitter(w = 500, h = 20)) + 
  scale_colour_gradient(low = "white", high = "blue")

```

If we shift to the system of Prosper Score, the similar trend will appear again: high grade will not guarantee to have more investors, but will guarantee higher possibility to have. If we ignore the importance of the outliers which is over 600 investors, the clear dark-blue curve is over the other data points. 

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(aes(x = LoanOriginalAmount, y = Investors, color = LenderYield), 
       data = subset(simplified_pLD, ProsperRating..Alpha.!= "")) + 
  geom_point(position = position_jitter(w = 500, h = 20)) + 
  scale_colour_gradient(low = "white", high="red")

```

For the large Amount of loan more than 25000, people lend money at a low rate yield. At the most time, the darkest red points, i.e. the highest yield rates, just concentrate the loan which is under 15000. 

And we can also find that low rates of yield have a wide range of numbers of investors, we can see the light points spread out forming straight lines horizontally in different amounts of loan. A more interesting thing is that the high Lender Yield may have chance to have many investors, especially for the large amount of loan up to 25000.

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(aes(x = LoanOriginalAmount, y = Investors, color = LenderYield), data = 
         subset(simplified_pLD, ProsperRating..Alpha.!= "")) + 
  geom_point(position = position_jitter(w = 500, h = 20)) + 
  scale_colour_gradient(low = "white", high="red") + 
  facet_wrap(~ ProsperRating..Alpha.)

```

Since there is a strong correlation between grade and lender yield, the color gets lighter while the grade gets better.

As we can see, some dark points which climb up to the level of 1000 in the number of investors appear to be the C-grade borrowers, which pay at a intermediate rate of Lender Yield.

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggthemr_reset()
ggthemr('grape')
ggplot(aes(x = LenderYield, y = Investors), 
              data = subset(simplified_pLD, ProsperRating..Alpha.!= "")) + 
  geom_point(aes(color = ProsperRating..Alpha.), stat = 'summary', 
             fun.y = mean) + facet_wrap(~ ProsperRating..Alpha.) + 
  scale_color_brewer(type = 'seq', guide = 
                       guide_legend(title = "Prosper Rating", 
                                    override.aes = 
                                      list(alpha = 1, size = 2), reverse=T)) 
```

Even on the same level of yield, the AA-grade borrowers are likely to gain more investors.

Can we say borrowers with top grade is more attractive to the investors? Maybe not. At this time, I thoroughly reconsider the aim of this research, doubting the meaning of predicting the number of investors. When we investigate the number of investors, it is more accurate to ask the question in this way: "how many investors do a loan need to fulfill its requirement of loan amount?" 

Because people may be attracted by the loan and invest with a great amount of money, but we can not going to say that the investment is not "attractive" since there are limited places for investing a P2P loan. So I find that the concept of "attraction" I used before is a bit misleading. High amount of investors may just represent one side of "attraction", which appeals the investors who prefer investing in small amount.

Next, I want to see the another side of "attraction" of the loan : averagely, how much an investor have invested.

```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(aes(x = LenderYield, y = LoanOriginalAmount/Investors), 
              data = subset(simplified_pLD, ProsperRating..Alpha.!= "")) +
  geom_point(aes(color = ProsperRating..Alpha.), stat = 'summary', fun.y = mean) + 
  facet_wrap(~ ProsperRating..Alpha., scales = "free") + 
  scale_color_brewer(type = 'seq', guide = 
                       guide_legend(title = "Prosper Rating", 
                                    override.aes = 
                                      list(alpha = 1, size = 2), reverse=T)) 
```

The differences of outliers between different grades become so obvious. From HR-grade to C-grade, investors are going to invest more and more. From C-grade to AA-grade, the amount of individual investment start to shrink. But we should notice there are vertical straight lines staying on the ground in every graphs, indicating that the majority of investors just want to invest in a small number.

What will happen if we include the consideration of loan terms?

```{r echo=FALSE, message=FALSE, warning=FALSE}
simplified_pLD$Term <- factor(simplified_pLD$Term, levels = sort(unique(simplified_pLD$Term)))

ggthemr('earth')

ggplot(aes(x = LenderYield, y = LoanOriginalAmount/Investors, group=Term), 
              data = subset(simplified_pLD, ProsperRating..Alpha.!= "")) + 
  geom_point(aes(shape=Term, color=Term), stat = 'summary', fun.y = mean) + 
  facet_wrap(~ ProsperRating..Alpha., scales = "free") 
```

In general, C-grade and B-grade can attract investors to invest in larger amount across different rates of yield in 36-term and 60-term. Unlike A-grade, they just don't hit the peak of the numbers when their number is split into three categories.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# in order to keep identical to the color before, not going to tune into the 
# sequential color

ggthemr('grape')

ggplot(aes(x = LenderYield, y = LoanOriginalAmount/Investors), 
              data = subset(simplified_pLD, ProsperRating..Alpha.!= "")) + 
  geom_point(aes(color = ProsperRating..Alpha.), stat = 'summary', 
             fun.y = mean) + 
  facet_wrap(~ Term) + scale_color_brewer(type = 'seq') 

```

Some of the people may want to invest in borrowers with A-grade with huge amount of money if they are going to invest in a long term in 5-year-loan. I think it is because people want to balance the need of safe investment and more return in a long-term investment. But the density of A-grade points are actually similar to the density of B-grade, showing the peak may be just the minority.

In the term of 36, The density of A-grade line are more similar to lines from B-grade C-grade.

And it is also funny to observe that the changes of investment amount of a investor. The differences between the 1-year-loan and 3-year-loan is much huge than 3-year-loan and 5-year-loan.

Lastly, I try using a linear model to see if we can find the way to predict the number of investors and the amount of loan in the linear regression:

Predicting the number of invesotrs:

```{r echo=FALSE, message=FALSE, warning=FALSE, Building_the_Linear_Model_1}
library(memisc) 
m1 <- lm(Investors ~ LoanOriginalAmount, data = simplified_pLD_numeric)
m2 <- update(m1, ~ . + ProsperRating..numeric.)
m3 <- update(m2, ~ . + ProsperScore)
m4 <- update(m3, ~ . + LenderYield)
m5 <- update(m4, ~ . + Term)
m6 <- update(m5, ~ . + AverageScore)
mtable(m1, m2, m3, m4, m5, m6)

```

Predicting the lending amount of an invesotrs:

```{r echo=FALSE, message=FALSE, warning=FALSE, Building_the_Linear_Model_2}

m1 <- lm(LoanOriginalAmount/Investors ~ ProsperRating..numeric., data = simplified_pLD_numeric)
m2 <- update(m1, ~ . + AverageScore)
m3 <- update(m2, ~ . + ProsperScore)
m4 <- update(m3, ~ . + LenderYield)
m5 <- update(m4, ~ . + Term)
mtable(m1, m2, m3, m4, m5)

```

Although we have observe some kinds of patterns in our graph, the R-squared scores are quite low in both of the models and we cannot predict their numbers in the way of linear regression.


# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

In short:

* If a borrower borrows with relatively huge amount and has a good grade, he is more likely to need lots of investors to fulfil the loan origination in general.

* If a borrower has a C-grade, he is going to have fewer investors but with larger individual investment.

* If a borrower has the rating from A-grade to C-grade and demands a 5-year-loan, he is more likely to gain investors who prefer larger individual investment.

### Were there any interesting or surprising interactions between features?

No matter whether the investors want to invest with small amounts or large amounts, lots of people seem to prefer the intermediate grade "C". I think the reason is because it is exactly "intermediate": intermediate return and risk. People with C-grade need to pay more for their interests and is not going to fail paying the loan comparing grades like D and E.

So......maybe this is the reason why every time I click into the page of Prosper-Invest, I can see the recommendation of C-grade loan stand in the middle of choices.

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

I have created a linear model and don't think it is helpful. As we can see, people borrow and lend in their different preferences. 

It is true that many low grade borrowers don't borrow a lot and gain so few investors, but this may be also something happening to some of the high grade borrowers. Therefore we can observe the points and lines get up and down in the line graph, no matter how great their grades are.

At last


# Final Plots and Summary

### Plot One

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_One}
# change the defalut behaviour of ggplot

ggthemr('chalk')
theme_update(plot.title = element_text(hjust = 0.5))

ggplot(aes(Investors), data = pLD) + geom_histogram() + scale_x_log10(
   breaks = scales::trans_breaks("log10", function(x) 10^x),
   labels = scales::trans_format("log10", scales::math_format(10^.x))
 ) + 
  labs(y = "Number of Loans", x = "Number of Investors", 
       title = "Log_10 Investors Number")
```

### Description One

The majority of loans just need small amounts of investors, which just reach the magnitude of 10^(0), to fulfill the amounts of loans. Besides this majority, the distribution of investors' numbers in other loans form a normal distribution with high variance, which means the variety of investors' numbers very high as well.


### Plot Two

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Two}

ggthemr('lilac')
theme_update(plot.title = element_text(hjust = 0.5))
ggplot(aes(x = ProsperRating..Alpha., y = Investors), 
       data = subset(simplified_pLD, ProsperRating..Alpha. != "")) +
        geom_boxplot(fill = fill, colour = line) + 
  coord_cartesian(ylim=c(0, 300)) + 
  labs(y = "Number of Investors", x = "Prosper Rating (in Alphabet)", 
       title = "Number of Investors by Prosper Rating ( In Alphabet )")

```

### Description Two

From C-grade to AA-grade, the number of investors is rising up. But it is still possible for lower grades to have more investors to fulfill their loans. Firstly, there are some outliers placed on the upper side of the boxplot in grades from HR to D. Secondly, by comparing the bold lines in the boxes, the mean number of grade C or B is lower than grade HR, E or D.

### Plot Three

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Three}

levels(simplified_pLD$Term) <- c("1-year-loan", "3-year-loan", "5-year-loan")
ggthemr('grape')
theme_update(plot.title = element_text(hjust = 0.5))
ggplot(aes(x = LenderYield, y = LoanOriginalAmount/Investors), 
              data = subset(simplified_pLD, ProsperRating..Alpha.!= "")) + 
  geom_point(aes(color = ProsperRating..Alpha.), stat = 'summary', 
             fun.y = mean) + facet_wrap(~ Term) + 
  scale_color_brewer(type = 'seq', guide = 
                       guide_legend(title = "Prosper Rating", 
                                    override.aes = list(alpha = 1, size = 2), 
                                    reverse=T)) +
  labs(y = "Average investing amount of an investor (in dollar) ", 
       x = "Rate of Lender Yield", 
       title = "Average Investing amount of an investor by Lender Yield, 
       Prosper Rating and Terms", color = "Prosper Rating (in Alphabet)") 

```

### Description Three

1-year-loan can only attract lenders to invest in very small amounts individually. But 3-year-loan and 5-year-loan can attract much more of this kind of individuall investments. In both situations, the density of individuall investments on AA-Grade, the greatest rating, is not higher than A-, B- or C-Grade.

Interesting is, the differences between the amounts of 3-year-loan and 5-year-loan are not as huge as between the amounts of 1-year-loan and 3-year-loan, even though the durations increase by 2 years in both cases.

------

# Reflection

The successful thing in this analyze is to review the meaning of different variables in the data set in an overall perspective, because this data set is just too big and we are not going to investigate every variables. I may put too much time on reviewing many variables in uni-variable analyze, but this way of research helps analysts to rethink what is the most interesting part in the dataset.

The frustrating thing is that the journey of uni-variable analyze seemed endless to me at the first beginning. You need to pick some variables from the data set, but why these rather than the others ? Is there a logic to present the data in a more reasonable way rather than picking them according to personal preferences ? At last, I analyze them in the time line of how a loan is created. It appears to have a better result in order to understand the system of Prosper.

Also, at first I lack of thoughts about the meaning of number of investors and once question whether I should restart my research at some points. But it is just a different way to see the problem, because huge number of investors also means that it attracts people to invest in small amounts, so there will be more places for more participants. 

I hope at the end, everything looks good.

I think there is also an option to examine the topic of "attraction". We have the variables of the "LoanOriginationDate" and "ListingCreationDate" in the data set. The first one states when the loan is successfully issued and the second one states when it is listed on the website, waiting for the investment. The differences between these two dates can be interpreted as: how fast is the loan proposal fully accepted?

I hope one day I can find the mystery of the credit score as, if I have time to do so. This project really takes time and it is not as easy as I thought before. 